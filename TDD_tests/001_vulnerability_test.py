from time import sleep
from selenium import webdriver
from selenium.webdriver.common.by import By
from selenium.webdriver.support.wait import WebDriverWait
from selenium.webdriver.support import expected_conditions as EC
from Screenshot import Screenshot_Clipping
import time
from selenium.webdriver.common.action_chains import ActionChains

driver = webdriver.Chrome()
driver.maximize_window()

# Locators
URL_FLD = (By.XPATH, "//input[@inputmode='search']")
DMN_MN_ONE = (By.CLASS_NAME, "multiselect__single")
DMN_MN_TWO = (By.CSS_SELECTOR, "svg.target__icon.icon")
SRCH_BTN = (By.XPATH, "//button[@name='enter_short']")
TITLE = (By.XPATH, "(//div[@class='line-clamp-cell'])[1]")
ALEXA_RANK = (By.XPATH, "(//div[@class='cell table__td'])[3]")
REGISTAR = (By.XPATH, "(//div[@class='cell table__td'])[4]")
ISSUER_ORG = (By.XPATH, "(//div[@class='cell table__td'])[5]")

# Explicit wait
wait = WebDriverWait(driver, 15)

# 1. Open the url
driver.get( 'https://spyse.com/' )

# 2. Choose Domain from drop-dawn menu
wait.until(EC.presence_of_element_located(DMN_MN_ONE)).click()
target = wait.until(EC.element_to_be_clickable(DMN_MN_TWO))
actions = ActionChains(driver)
actions.move_to_element(target)
sleep(2)
actions.click(on_element = target)
actions.perform()

# 2.1. Send https://xkpasswd.net/s/ to field
url_t_tst = 'https://xkpasswd.net/s/'
wait.until(EC.presence_of_element_located(URL_FLD)).clear()
wait.until(EC.presence_of_element_located(URL_FLD)).send_keys(url_t_tst)

# 3. Click on Search button
wait.until(EC.element_to_be_clickable(SRCH_BTN)).click()

# 4. Find security score, critical risk, medium risk, elevated risk
title = wait.until(EC.visibility_of_element_located(TITLE)).text.lower()
alexa_rank = wait.until(EC.visibility_of_element_located(ALEXA_RANK)).text.lower()
registar = wait.until(EC.visibility_of_element_located(REGISTAR)).text.lower()
issuer_org = wait.until(EC.visibility_of_element_located(ISSUER_ORG)).text.lower()
print(f'Security score: "{title}";\nCritical risk: "{alexa_rank}";\nMedium risk: "{registar}"\n'
      f'Elevated risk: "{issuer_org}"')

# 5. Make a screenshot of the whole page
ob=Screenshot_Clipping.Screenshot()
url = driver.current_url
today = time.strftime(f'%Y_%m_%d')
now = time.strftime(f'%H_%M_%S')
file_name = 'vulnerability_' + today + '_' + now + '.jpg'
img_url=ob.full_Screenshot(driver, save_path=r'C:\Everything\IT\Testing\Automation_08_09_2019\xkpassw\screen_shots', image_name= file_name)
print(img_url)

driver.close()

# Sleep to see what we have
sleep(4)

# Driver quit
driver.quit()


